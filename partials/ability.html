<div class="row">
	<div class="col-sm-3 col-md-2">
		<div id="listCntr" class="listCntr noSelect" ui-sortable ng-model="abilityList">
			<div ng-repeat="_ability in abilityList track by $index" class="listItem"
			     ng-class="{active: ability == _ability}"
				 ng-mousedown="setAbilityMouseDown(_ability);">
				<p class="title">
					<span class="fa sm" ng-class="{'fa-asterisk': _ability._changed, 'fa-circle': !_ability._changed}" style="color: {{config.abilities[_ability._name].markColor || '#CCC'}}"></span>
					<span class="fa fa-cubes sm" ng-if="config.abilities[_ability._name].markUsage === 'dummy'"></span>
					{{config.abilities[_ability._name].editorAliasName || _ability._name}}
					<span class="fa fa-exclamation-triangle text-danger" ng-if="conflictMap[_ability._name]"
						  uib-tooltip="Conflict name 【名称冲突】" tooltip-placement="right" tooltip-append-to-body="true"></span>
				</p>
				<p class="desc">{{_ability._comment}}</p>
			</div>
		</div>
		<button id="newItem" class="btn btn-primary" ng-click="newAbility()">+ New 【新建】</button>
	</div>
	<div class="col-sm-9 col-md-10" ng-show="!ready">
		<h1>Loading... 【载入中】</h1>
	</div>
	<div class="col-sm-9 col-md-10" ng-class="{abilityCntr: ready && !ability}" ng-show="ready && !ability">
		<h1>No Ability Yet 【还未创建Ability】</h1>
	</div>
	<div class="col-sm-9 col-md-10" ng-class="{abilityCntr: ability}" ng-show="ability">
		<!-- ================================================================== -->
		<!-- =                           技能  引领                           = -->
		<!-- ================================================================== -->
		<div class="ability-cntr-header clearfix">
			<div class="ability-cntr-header-img">
				<img class="ability-img" onerror="iconError();" />
			</div>
			<div class="ability-cntr-header-desc">
				<ul class="nav nav-pills pull-right">
					<li class="active">
						<a data-toggle="tab" class="fa fa-file-code-o" href="[data-id='ability']"></a>
						<span class="nav-tip">Ability 【能力】</span>
					</li>
					<li>
						<a data-toggle="tab" class="fa fa-book" href="[data-id='description']"></a>
						<span class="nav-tip">Language 【语言】</span>
					</li>
					<li>
						<a class="fa fa-check-circle-o" ng-click="abilitiesCheck()"></a>
						<span class="nav-tip">Inspection 【检测】</span>
					</li>
					<li ng-show="isItem">
						<a class="fa fa-print" ng-click="itemPrecacheList()"></a>
						<span class="nav-tip">Precache Script 【预载脚本】</span>
					</li>
				</ul>

				<div class="ability-cntr-header-name ability-form">
					<span class="ability-tip">Name 【名称】</span>
					<input type="text" ng-model="ability._name" />
				</div>

				<div class="ability-form">
					<span class="ability-tip">Comment 【注释】</span>
					<textarea class="ability-form" ng-model="ability._comment" placeholder="Comment 【注释】..."></textarea>
				</div>
			</div>
		</div>

		<hr/>

		<!-- ================================================================== -->
		<!-- =                           技能  容器                           = -->
		<!-- ================================================================== -->
		<div class="tab-content ability-cntr-body">
			<div data-id="ability" class="tab-pane fade in active">
				<ul class="nav nav-pills">
					<li ng-class="{active: currentTab === 'common'}"><a ng-click="currentTab = 'common'">Common【常规】</a></li>
					<li ng-class="{active: currentTab === 'item'}" ng-show="isItem"><a ng-click="currentTab = 'item'">Item【物品】</a></li>
					<li ng-class="{active: currentTab === 'events'}"><a ng-click="currentTab = 'events'">Events【事件】({{ability._eventList.length}})</a></li>
					<li ng-class="{active: currentTab === 'modifiers'}"><a ng-click="currentTab = 'modifiers'">Modifiers【修饰器】({{ability._modifierList.length}})</a></li>
					<li ng-class="{active: currentTab === 'abilitySpecial'}"><a ng-click="currentTab = 'abilitySpecial'">Ability Special【自定义值】({{ability._abilitySpecialList.length}})</a></li>
				</ul>

				<div>
					<!-- ====================== 常规 ====================== -->
					<div ng-if="currentTab === 'common'">
						<table class="ability-table">
							<tbody ng-repeat="group in ability._attrList track by $index">
								<tr ng-repeat="unit in group.list track by $index" ng-show="unit.showFunc ? unit.showFunc() : true;">
									<th width="150">
										<span class="ability-tip">{{unit.title || unit.attr}}</span>
										{{Locale(unit.attr)}}
									</th>
									<td class="ability-form">
										<div attrfield attrfield data-ability="ability" data-attrunit="unit" data-srcunit="ability" data-srctmpl="Ability"></div>
									</td>
								</tr>
							</tbody>
						</table>
					</div>

					<!-- ====================== 物品 ====================== -->
					<div ng-if="currentTab === 'item'">
						<table class="ability-table">
							<tbody ng-repeat="group in ability._attrItemList track by $index">
							<tr ng-repeat="unit in group.list track by $index" ng-show="unit.showFunc ? unit.showFunc() : true;">
								<th width="150">
									<span class="ability-tip">{{unit.title || unit.attr}}</span>
									{{Locale(unit.attr)}}
								</th>
								<td class="ability-form">
									<div attrfield attrfield data-ability="ability" data-attrunit="unit" data-srcunit="ability" data-srctmpl="Ability"></div>
								</td>
							</tr>
							</tbody>
						</table>
					</div>

					<!-- ====================== 事件 ====================== -->
					<div ng-if="currentTab === 'events'">
						<table class="ability-table">
							<tbody ng-repeat="_index in optEventNum track by $index" ng-show="ability._eventList[_index]">
								<!-- 事件类型 -->
								<tr>
									<th width="120">
										<span class="ability-tip">Event Type</span>
										事件类型
									</th>
									<td class="ability-form">
										<select ng-model="ability._eventList[_index]._name">
											<option ng-repeat="_event in Event.EventList track by $index" value="{{::_event[0]}}">{{::_event[0]}} 【{{::_event[1]}}】</option>
										</select>
									</td>
									<td width="60" class="text-center">
										<a href="javascript:void(0)" ng-click="common.array.remove(ability._eventList[_index], ability._eventList)">
											Delete
										</a>
									</td>
								</tr>
								<!-- 事件备注 -->
								<tr>
									<th>
										<span class="ability-tip">Comment</span>
										备注
									</th>
									<td class="ability-form" colspan="2">
										<textarea class="form-control" ng-model="ability._eventList[_index]._comment" rows="3" placeholder="备注"></textarea>
									</td>
								</tr>
								<!-- 操作 -->
								<tr>
									<th>
										<span class="ability-tip">Operation</span>
										操作
									</th>
									<td class="ability-form" colspan="2" style="background: #FFF">
										<div eventoperation data-container="ability._eventList[_index]" data-path="_operationList" data-ability="ability" data-isitem="isItem"></div>
									</td>
								</tr>
							</tbody>

							<tbody ng-if="ability._eventList.length === 0">
								<tr>
									<td>
										<p>No Event 【没有事件】</p>
									</td>
								</tr>
							</tbody>
						</table>
						<button class="btn btn-dark" ng-click="addEvent()">+ new event 【新建事件】</button>
					</div>

					<!-- ===================== 修饰器 ===================== -->
					<div ng-show="currentTab === 'modifiers'">
						<ul class="ability-modifer-list nav nav-pills">
							<li class="active">
								<a ng-click="addModifier()">
									+ <span ng-show="!currentModifier">New Modifier 【新建修饰器】</span>
								</a>
							</li>
							<li ng-repeat="modifier in ability._modifierList" ng-class="{active: currentModifier === modifier}">
								<a ng-click="setModifier(modifier)">{{modifier._name}}</a>
								<a class="removeMark" ng-click="removeModifier(modifier)">[X] Delete</a>
							</li>
						</ul>

						<table class="ability-table" ng-show="currentModifier">
							<!-- Modifier: Common -->
							<tbody ng-repeat="group in currentModifier._attrList track by $index">
								<tr ng-repeat="unit in group.list track by $index" ng-if="unit.showFunc ? unit.showFunc() : true;">
									<th width="150">
										<span class="ability-tip">{{unit.title || unit.attr}}</span>
										{{Locale(unit.attr)}}
									</th>
									<td class="ability-form">
										{{unit.link}}
										<a class="fa fa-link" ng-if="unit.link && unit.link(currentModifier[unit.attr], ability)" ng-click="unit.link(currentModifier[unit.attr], ability)()"></a>
										<div attrfield data-ability="ability" data-attrunit="unit" data-srcunit="currentModifier" data-srctmpl="Modifier"></div>
									</td>
								</tr>
							</tbody>

							<!-- Modifier: Prop -->
							<tbody>
								<tr>
									<th>
										<span class="ability-tip">Properties</span>
										{{Locale('Properties')}}
									</th>
									<td>
										<div class="ability-modifer-prop-list">
											<ul>
												<li ng-repeat="_prop in currentModifier._propertyList track by $index">
													<a ng-click="common.array.remove(_prop, currentModifier._propertyList)">[X]</a>
													<div class="ability-modifer-item-select">
														<select ng-model="_prop[0]">
															<option ng-repeat="item in Modifier.Properties track by $index" value="{{::item[0]}}">
																{{item[0].replace("MODIFIER_PROPERTY_", "")}} 【{{item[1]}}】
															</option>
														</select>
													</div>
													<input type="text" class="form-control" ng-model="_prop[1]" />
												</li>
											</ul>
											<a class="add-link" ng-click="currentModifier._propertyList.push(['MODIFIER_PROPERTY_ABSOLUTE_NO_DAMAGE_MAGICAL', ''])">+ new Property 【添加属性】</a>
										</div>
									</td>
								</tr>
							</tbody>

							<!-- Modifier: State -->
							<tbody>
								<tr>
									<th>
										<span class="ability-tip">States</span>
										{{Locale('States')}}
									</th>
									<td>
										<div class="ability-modifer-prop-list">
											<ul>
												<li ng-repeat="_state in currentModifier._stateList track by $index">
													<a ng-click="common.array.remove(_state, currentModifier._stateList)">[X]</a>
													<div class="ability-modifer-item-select">
														<select ng-model="_state[0]">
															<option ng-repeat="item in Modifier.States track by $index" value="{{::item[0]}}">
																{{item[0].replace("MODIFIER_STATE_", "")}} 【{{item[1]}}】
															</option>
														</select>
													</div>
													<select ng-model="_state[1]">
														<option ng-repeat="item in Modifier.StateValues track by $index" value="{{::item[0]}}">
															{{item[0].replace("MODIFIER_STATE_VALUE_", "")}} 【{{item[1]}}】
														</option>
													</select>
												</li>
											</ul>
											<a class="add-link" ng-click="currentModifier._stateList.push(['MODIFIER_STATE_ATTACK_IMMUNE', ''])">+ new State 【添加状态】</a>
										</div>
									</td>
								</tr>
							</tbody>

							<!-- Modifier: Events -->
							<tbody>
								<tr>
									<th>
										<span class="ability-tip">Events</span>
										{{Locale('Events')}}
									</th>
									<td style="padding: 5px">
										<table class="ability-table">
											<tbody ng-repeat="_index in optEventNum track by $index" ng-show="currentModifier._eventList[_index]">
											<!-- Event Type -->
											<tr>
												<th width="120">
													<span class="ability-tip">Event Type</span>
													{{Locale('Event Type')}}
												</th>
												<td class="ability-form">
													<select ng-model="currentModifier._eventList[_index]._name">
														<option ng-repeat="_event in Event.ModifierEventList track by $index" value="{{::_event[0]}}">{{::_event[0]}} 【{{::_event[1]}}】</option>
													</select>
												</td>
												<td width="60" class="text-center">
													<a href="javascript:void(0)" ng-click="common.array.remove(currentModifier._eventList[_index], currentModifier._eventList)">
														Delete
													</a>
												</td>
											</tr>

											<!-- Event Comment -->
											<tr>
												<th>
													<span class="ability-tip">Comment</span>
													{{Locale('_comment')}}
												</th>
												<td class="ability-form" colspan="2">
													<textarea class="form-control" ng-model="currentModifier._eventList[_index]._comment" rows="3" placeholder="备注"></textarea>
												</td>
											</tr>

											<!-- Event Operation -->
											<tr>
												<th>
													<span class="ability-tip">Operation</span>
													{{Locale('Operation')}}
												</th>
												<td class="ability-form" colspan="2" style="background: #FFF">
													<div eventoperation data-container="currentModifier._eventList[_index]" data-path="_operationList" data-ability="ability" data-isitem="isItem"></div>
												</td>
											</tr>
											</tbody>
										</table>

										<a ng-click="addEvent(currentModifier)">+ new event 【新建事件】</a>
									</td>
								</tr>
							</tbody>
						</table>

						<p ng-if="ability._modifierList.length === 0">No Modifier 【没有修饰器】</p>
					</div>

					<!-- ==================== 自定义值 ==================== -->
					<div ng-if="currentTab === 'abilitySpecial'">
						<table class="ability-table">
							<thead>
								<tr>
									<th width="34"></th>
									<th>Key 【变量名】</th>
									<th>type 【类型】</th>
									<th>Value 【变量值】</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="_abilitySpecial in ability._abilitySpecialList track by $index">
									<th>
										<a href="javascript:void(0)" ng-click="common.array.remove(_abilitySpecial, ability._abilitySpecialList)">[X]</a>
									</th>
									<td class="ability-form">
										<input type="text" ng-model="_abilitySpecial[0]" />
									</td>
									<td class="ability-form">
										<select ng-model="_abilitySpecial[1]">
											<option ng-repeat="type in Ability.AbilitySpecialType track by $index" value="{{::type[0]}}">
												{{type[0]}}
												【{{type[1]}}】
											</option>
										</select>
									</td>
									<td class="ability-form">
										<input type="text" ng-model="_abilitySpecial[2]" />
									</td>
								</tr>
								<tr ng-if="ability._abilitySpecialList.length === 0">
									<td colspan="4">
										<p>No value 【没有自定义值】</p>
									</td>
								</tr>
							</tbody>
						</table>

						<button class="btn btn-dark" ng-click="ability._abilitySpecialList.push([])">+ new Key Value 【新建键值】</button>
					</div>

				</div>
			</div>

			<!-- ============================================== -->
			<!-- =                    描述                    = -->
			<!-- ============================================== -->
			<div data-id="description" class="tab-pane fade">
				<!-- 没有语言文件 -->
				<div ng-show="languageList.length === 0">
					<h3>No Language File find</h3>
					<h3>【没有找到语言文件】</h3>
					<p>Please check your language file in {{::Language.folderPath}} folder.</p>
					<p>【请检查{{::Language.folderPath}}目录下的语言文件】</p>
				</div>

				<!-- 拥有语言文件 -->
				<div class="row" ng-show="languageList.length !== 0">
					<div class="col-md-2">
						<div class="listCntr">
							<div ng-repeat="_lang in languageList track by $index" class="listItem"
							     ng-class="{active: language == _lang}" ng-click="setLanguage(_lang);">
								<p>{{_lang.name}}</p>
							</div>
						</div>
					</div>
					<div class="col-md-10">
						<p ng-show="!language.ready">Loading...</p>

						<!-- ========================== -->
						<!-- =          描述          = -->
						<!-- ========================== -->
						<div ng-if="language">
							<h3>Description 【描述】</h3>
							<table class="ability-table" ng-show="language.ready">
								<tbody>
									<!-- 常规描述 -->
									<tr ng-repeat="langField in Language.AbilityLang track by $index">
										<th width="150">
											<span class="ability-tip">{{langField.attr || langField.title}}</span>
											{{langField.desc}}
										</th>
										<td>
											<button class="btn btn-default fa fa-paint-brush color-picker"></button>
											<input type="text" class="form-control" ng-if="langField.type === 'text'"
											       ng-model="language.map[Language.abilityAttr(ability._name, langField.attr)]" />
											<textarea class="form-control" ng-if="langField.type === 'blob'" rows="5"
											          ng-model="language.map[Language.abilityAttr(ability._name, langField.attr)]"></textarea>
										</td>
									</tr>

									<!-- 自定义值 -->
									<tr>
										<th colspan="2" class="success">
											AbilitySpecial 【自定义值】
										</th>
									</tr>
									<tr ng-repeat="_index in optLangAbilitySpecialNum track by $index" ng-show="ability._abilitySpecialList[_index]">
										<th>{{ability._abilitySpecialList[_index][0]}}</th>
										<td>
											<button class="btn btn-default fa fa-paint-brush color-picker"></button>
											<input type="text" class="form-control"
												   ng-model="language.map[Language.abilityAttr(ability._name, ability._abilitySpecialList[_index][0])]"
													/>
										</td>
									</tr>
								</tbody>
							</table>

							<!-- ========================== -->
							<!-- =         修饰器         = -->
							<!-- ========================== -->
							<h3>Modifiers 【修饰器】</h3>
							<table class="ability-table" ng-show="language.ready">
								<tbody ng-repeat="_index in optLangModifierNum track by $index" ng-show="ability._modifierList[_index]">
									<tr>
										<th colspan="2" class="success">
											<span class="glyphicon glyphicon-tag"></span> {{ability._modifierList[_index]._name}}
											<span ng-if="ability._modifierList[_index].IsHidden === '1'" class="label label-info">Hidden 【隐藏】</span>
										</th>
									</tr>
									<tr ng-repeat="langField in Language.ModifierLang track by $index">
										<th width="150">
											<span class="ability-tip">{{langField.attr || langField.title}}</span>
											{{langField.desc}}
										</th>
										<td>
											<button class="btn btn-default fa fa-paint-brush color-picker"></button>
											<input type="text" class="form-control" ng-if="langField.type === 'text'"
													ng-model="language.map[Language.modifierAttr(ability._modifierList[_index]._name, langField.attr)]" />
											<textarea class="form-control" ng-if="langField.type === 'blob'" rows="5"
													ng-model="language.map[Language.modifierAttr(ability._modifierList[_index]._name, langField.attr)]"></textarea>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- ====================================================================== -->
<!-- =                              技能菜单                              = -->
<!-- ====================================================================== -->
<ul id="abilityMenu" class="app-menu app-float-menu">
	<li><a ng-click="setAbilityEditorAlias()">Editor Alias 【编辑器别名】</a></li>
	<li class="app-submenu">
		<a>Usage Marker 【功能标记】</a>
		<ul class="app-menu">
			<li><a ng-click="setAbilityMarkUsage('dummy');"> Dummy Ability 【马甲技能】</a></li>
			<li class="line"></li>
			<li><a ng-click="setAbilityMarkUsage();"> No mark 【无标记】</a></li>
		</ul>
	</li>
	<li class="app-submenu">
		<a>Color Marker 【颜色标记】</a>
		<ul class="app-menu">
			<li><a ng-click="setAbilityMarkColor('#00a65a');"><span class="fa fa-circle sm" style="color: #00a65a;"></span> Green 【绿色】</a></li>
			<li><a ng-click="setAbilityMarkColor('#00c0ef');"><span class="fa fa-circle sm" style="color: #00c0ef;"></span> Blue 【蓝色】</a></li>
			<li><a ng-click="setAbilityMarkColor('#dd4b39');"><span class="fa fa-circle sm" style="color: #dd4b39;"></span> Red 【红色】</a></li>
			<li><a ng-click="setAbilityMarkColor('#f39c12');"><span class="fa fa-circle sm" style="color: #f39c12;"></span> Yellow 【黄色】</a></li>
			<li><a ng-click="setAbilityMarkColor('#666666');"><span class="fa fa-circle sm" style="color: #666666;"></span> Black 【黑色】</a></li>
			<li class="line"></li>
			<li><a ng-click="setAbilityMarkColor();"><span class="fa fa-circle sm" style="color: #cccccc;"></span> None 【还原】</a></li>
		</ul>
	</li>
	<li><a ng-click="copyAbility()">Duplicate Ability 【复制技能】</a></li>
	<li class="line"></li>
	<li><a ng-click="deleteAbility()" class="danger">Delete Ability 【删除技能】</a></li>
</ul>

<!-- ====================================================================== -->
<!-- =                           新建技能对话框                           = -->
<!-- ====================================================================== -->
<div class="modal fade" id="newMDL" tabindex="-1">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Select Template 【选择技能模板】</h4>
			</div>
			<div class="modal-body">
				<div class="form-group">
					<label>Type 【类型】</label>
					<select class="form-control" ng-model="newAbility._type">
						<option ng-repeat="_type in newAbility.type" value="{{::_type[2]}}">{{::_type[0]}} 【{{::_type[1]}}】</option>
					</select>
				</div>
				<div class="form-group" ng-show="newAbility._type !== 'Passive'">
					<label>Target 【目标】</label>
					<select class="form-control" ng-model="newAbility._target">
						<option ng-repeat="_target in newAbility.target" value="{{::_target[2]}}">{{::_target[0]}} 【{{::_target[1]}}】</option>
					</select>
				</div>
				<div class="checkbox" ng-show="newAbility._type !== 'Passive'">
					<label>
						<input type="checkbox" ng-checked="newAbility._channelled" ng-click="newAbility._channelled = !newAbility._channelled;"> Channelled 【持续施法】
					</label>
				</div>
				<div class="checkbox" ng-show="isItem">
					<label uib-tooltip="Will auto find no conflict ID between 1000 to 5000 【会自动寻找1000~5000中未使用过的ID】" tooltip-placement="right" tooltip-append-to-body="true">
						<input type="checkbox" ng-checked="newAbility._autoID" ng-click="newAbility._autoID = !newAbility._autoID;"> Item auto assign ID 【物品自动分配ID】
					</label>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary" ng-click="newAbility.confirm()">Create</button>
			</div>
		</div>
	</div>
</div>

<!-- Check report -->
<div class="modal fade" id="checkReportMDL" tabindex="-1">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Check Report 【检测报告】</h4>
			</div>
			<div class="modal-body">
				<div class="form-group">
					<label>Filter 【过滤】</label>
					<input type="text" class="form-control" ng-model="checkReportFilter"/>
				</div>

				<ul>
					<li ng-repeat="item in checkReport.language | filter: checkReportFilter">
						[{{item.language.name}}]
						<a href="javascript:void(0)" ng-click="setAbility(item.ability);">{{item.ability._name}}</a>
						<span ng-if="item.modifier">-> {{item.modifier._name}}</span>:
						<span ng-if="item.field.attr">[{{item.field.attr}}]</span> miss
					</li>
				</ul>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>